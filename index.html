<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Clicker Adventure: Journey to the Stars</title>
    <style>
        body {
            font-family: 'Comic Sans MS', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
            transition: background 0.5s;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00bfff;
        }

        #counter {
            font-size: 48px;
            margin: 20px;
            text-shadow: 0 0 15px #00bfff;
        }

        #level {
            font-size: 24px;
            color: #ffcc00;
            margin-top: 10px;
        }

        #talentPoints {
            font-size: 20px;
            color: #ff9900;
            margin-top: 5px;
        }

        #clicker {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.7);
            transition: transform 0.1s ease;
            margin: 20px auto;
            display: block;
            position: relative;
        }

        #clicker:active {
            transform: scale(0.9);
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            margin: 10px;
            border-radius: 10px;
            display: inline-block;
            width: 220px;
            transition: background 0.3s;
        }

        .shop-item:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        button {
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin-top: 8px;
        }

        button:disabled {
            background: #888;
            cursor: not-allowed;
        }

        .talent-tree-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            position: relative;
        }

        .talent-tree {
            display: flex;
            justify-content: center;
            gap: 80px;
            position: relative;
            z-index: 2;
        }

        .talent-node {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(100, 100, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
            transition: background 0.3s;
        }

        .talent-node.active {
            background: rgba(0, 255, 0, 0.5);
        }

        .talent-node.locked {
            background: rgba(100, 100, 100, 0.3);
            cursor: not-allowed;
        }

        .talent-node button {
            padding: 3px 8px;
            font-size: 12px;
            margin-top: 5px;
        }

        .achievement {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: gold;
            padding: 10px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }

        .daily-reward {
            background: rgba(0, 100, 0, 0.8);
            color: white;
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            display: none;
        }

        .buffs {
            margin-top: 20px;
            color: #aaffaa;
        }

        .quests {
            margin-top: 20px;
            color: #aaffaa;
        }

        .leaderboard {
            background: rgba(0, 100, 100, 0.8);
            color: white;
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            display: none;
        }

        .click-effect {
            position: absolute;
            font-size: 20px;
            color: gold;
            pointer-events: none;
            animation: floatUp 1s forwards;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç–∞–ª–∞–Ω—Ç–∞ */
        @keyframes glowPulse {
            0% { transform: scale(1); box-shadow: 0 0 5px #fff; }
            50% { transform: scale(1.2); box-shadow: 0 0 20px #00ff00; }
            100% { transform: scale(1); box-shadow: 0 0 5px #fff; }
        }

        .talent-node.pulse {
            animation: glowPulse 0.5s ease;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Å–∫–∏–Ω–æ–≤ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px #fff; }
            50% { box-shadow: 0 0 30px #00bfff; }
            100% { box-shadow: 0 0 10px #fff; }
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        /* –†—É–ª–µ—Ç–∫–∞ */
        .wheel {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(
                #ff0000 0deg 60deg,
                #00ff00 60deg 120deg,
                #0000ff 120deg 180deg,
                #ffff00 180deg 240deg,
                #ff00ff 240deg 300deg,
                #00ffff 300deg 360deg
            );
            margin: 20px auto;
            position: relative;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            cursor: pointer;
        }

        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid red;
            z-index: 10;
        }

        .wheel-inner {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: #222;
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .wheel-container {
            display: none;
            margin: 20px;
        }

        /* –°–µ–∑–æ–Ω */
        .season {
            background: rgba(255, 100, 0, 0.3);
            padding: 10px;
            margin: 10px;
            border-radius: 10px;
            display: none;
        }

        /* –ú–∏–Ω–∏-–∏–≥—Ä—ã */
        .minigame {
            display: none;
            margin: 20px;
            padding: 20px;
            background: rgba(0, 100, 100, 0.5);
            border-radius: 10px;
        }

        .click-timer {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #f00;
            margin: 20px auto;
            position: relative;
            transition: background 0.1s;
        }

        .click-timer.green {
            background: #0f0;
        }

        .coin {
            position: absolute;
            width: 30px;
            height: 30px;
            background: gold;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: black;
        }

        /* –£–º–µ–Ω–∏—è */
        .skills {
            margin-top: 20px;
            color: #aaffaa;
        }

        .skill {
            background: rgba(100, 100, 255, 0.2);
            padding: 10px;
            margin: 10px;
            border-radius: 8px;
            display: inline-block;
            width: 200px;
        }

        .skill button {
            padding: 5px 10px;
            font-size: 14px;
        }

        /* –°—é–∂–µ—Ç */
        .story {
            background: rgba(255, 200, 0, 0.2);
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            display: none;
        }

        .story-btn {
            margin-top: 10px;
        }

        /* –°—Ä–∞–∂–µ–Ω–∏–µ */
        .battle {
            background: rgba(255, 0, 0, 0.2);
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            display: none;
        }
    </style>
</head>
<body>

    <h1>üöÄ Clicker Adventure: Journey to the Stars</h1>
    <div id="counter">0</div>
    <div id="level">–£—Ä–æ–≤–µ–Ω—å: 1</div>
    <div id="talentPoints">–û—á–∫–∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤: 0</div>
    <button id="clicker" onclick="clickCounter()">üí•</button>

    <div id="daily-reward" class="daily-reward">
        <p>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞: <span id="daily-text">+100 –æ—á–∫–æ–≤!</span></p>
        <button onclick="claimDaily()">–ó–∞–±—Ä–∞—Ç—å</button>
    </div>

    <div class="buffs">
        <p>–ê–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ñ—Ñ—ã:</p>
        <div id="active-buffs"></div>
    </div>

    <div class="quests">
        <p>üéØ –ö–≤–µ—Å—Ç—ã:</p>
        <div id="active-quests"></div>
    </div>

    <h2>üß† –í–∏–∑—É–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Ç–∞–ª–∞–Ω—Ç–æ–≤</h2>
    <div class="talent-tree-container">
        <svg id="talent-connections" width="300" height="100" style="position: absolute; z-index: 1;"></svg>
        <div class="talent-tree">
            <div class="talent-node" id="talent-click">
                <p>üí• –ö–ª–∏–∫</p>
                <button onclick="buyTalent('clickBonus')">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="talent-node" id="talent-auto">
                <p>ü§ñ –ê–≤—Ç–æ</p>
                <button onclick="buyTalent('autoBonus')">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="talent-node" id="talent-level">
                <p>‚≠ê –£—Ä–æ–≤–µ–Ω—å</p>
                <button onclick="buyTalent('levelBonus')">–ö—É–ø–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="skills">
        <p>üß† –£–º–µ–Ω–∏—è:</p>
        <div class="skill">
            <p>üí• +10% –∫ –∫–ª–∏–∫—É</p>
            <button onclick="buySkill('clickBonus')">–£–ª—É—á—à–∏—Ç—å (1 –æ—á–∫–æ)</button>
        </div>
        <div class="skill">
            <p>ü§ñ +0.5 –∫ –∞–≤—Ç–æ–∫–ª–∏–∫—É</p>
            <button onclick="buySkill('autoBonus')">–£–ª—É—á—à–∏—Ç—å (1 –æ—á–∫–æ)</button>
        </div>
        <div class="skill">
            <p>‚ö° x2 –Ω–∞ 10 —Å–µ–∫</p>
            <button onclick="useSkill('multiplier')">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (3 –æ—á–∫–∞)</button>
        </div>
    </div>

    <div id="story" class="story">
        <p>üåå –°—é–∂–µ—Ç: –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –ó–µ–º–ª—é –æ—Ç —Ç–µ–º–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∏.</p>
        <p>üìç –õ–æ–∫–∞—Ü–∏—è: –ó–µ–º–ª—è</p>
        <p>üëæ –í—Ä–∞–≥: –ê—Å—Ç–µ—Ä–æ–∏–¥</p>
        <button class="story-btn" onclick="nextStory()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <div id="battle" class="battle">
        <p>‚öîÔ∏è –°—Ä–∞–∂–µ–Ω–∏–µ —Å: <span id="battle-enemy">–ê—Å—Ç–µ—Ä–æ–∏–¥</span></p>
        <p>–ö–ª–∏–∫–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="clicks-left">10</span></p>
        <p>–í—Ä–µ–º—è: <span id="time-left-battle">10</span> —Å–µ–∫</p>
        <button onclick="startBattle()">–ù–∞—á–∞—Ç—å —Å—Ä–∞–∂–µ–Ω–∏–µ</button>
    </div>

    <button id="share-btn" onclick="shareResult()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</button>
    <button id="send-to-chat-btn" onclick="sendResultToChat()" style="display: none;">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç</button>
    <button id="leaderboard-btn" onclick="requestLeaderboard()" style="display: none;">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</button>
    <button id="galaxy-btn" onclick="switchGalaxy()">üåå –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≥–∞–ª–∞–∫—Ç–∏–∫—É</button>
    <button id="wheel-btn" onclick="openWheel()">üé° –†—É–ª–µ—Ç–∫–∞</button>
    <button id="season-btn" onclick="checkSeason()">üéÅ –°–µ–∑–æ–Ω</button>
    <button id="minigame-btn" onclick="openMinigame()">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞</button>
    <button id="story-btn" onclick="openStory()">üìú –ò—Å—Ç–æ—Ä–∏—è</button>

    <div id="minigame-timer" class="minigame">
        <h3>‚è±Ô∏è –ö–ª–∏–∫–Ω–∏ –≤–æ–≤—Ä–µ–º—è!</h3>
        <div class="click-timer" id="timer" onclick="clickTimer()"></div>
        <p>–û—Å—Ç–∞–ª–æ—Å—å: <span id="time-left">3</span> —Å–µ–∫</p>
    </div>

    <div id="minigame-coins" class="minigame">
        <h3>ü™ô –°–æ–±–µ—Ä–∏ –º–æ–Ω–µ—Ç—ã!</h3>
        <p>–°–æ–±—Ä–∞–Ω–æ: <span id="coins-collected">0</span>/10</p>
        <div id="coin-area"></div>
    </div>

    <div id="wheel-container" class="wheel-container">
        <div class="wheel-pointer"></div>
        <div class="wheel" id="wheel">
            <div class="wheel-inner">–ö—Ä—É—Ç–∏—Ç—å!</div>
        </div>
        <button onclick="spinWheel()">–ö—Ä—É—Ç–∏—Ç—å!</button>
    </div>

    <div id="leaderboard" class="leaderboard">
        <h3>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
        <div id="leaderboard-list"></div>
    </div>

    <h2>üöÄ –£–ª—É—á—à–µ–Ω–∏—è</h2>
    <div class="shop">
        <div class="shop-item">
            <p>üí• –£—Ä–æ–Ω –∫–ª–∏–∫–∞: <span id="perClick">1</span></p>
            <p>–¶–µ–Ω–∞: <span id="cost1">10</span></p>
            <button onclick="buyUpgrade()">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="shop-item">
            <p>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫: <span id="autoClick">0</span>/—Å–µ–∫</p>
            <p>–¶–µ–Ω–∞: <span id="cost2">50</span></p>
            <button onclick="buyAutoclicker()">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="shop-item">
            <p>‚≠ê –ë–æ–Ω—É—Å x2 –∑–∞ –∫–ª–∏–∫</p>
            <p>–¶–µ–Ω–∞: <span id="cost3">200</span></p>
            <button onclick="buyMultiplier()">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="shop-item">
            <p>üí• x1.5 –∑–∞ –∫–ª–∏–∫</p>
            <p>–¶–µ–Ω–∞: <span id="cost4">300</span></p>
            <button onclick="buyUpgradeX15()">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="shop-item">
            <p>ü§ñ +0.5 –∫ –∞–≤—Ç–æ–∫–ª–∏–∫—É</p>
            <p>–¶–µ–Ω–∞: <span id="cost5">100</span></p>
            <button onclick="buyAutoclickerPlus()">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="shop-item">
            <p>üõ°Ô∏è –ë–æ–Ω—É—Å –∫ –±–∞—Ñ—Ñ–∞–º +10%</p>
            <p>–¶–µ–Ω–∞: <span id="cost6">400</span></p>
            <button onclick="buyBuffBonus()">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="shop-item">
            <p>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫ x2</p>
            <p>–¶–µ–Ω–∞: <span id="cost7">600</span></p>
            <button onclick="buyAutoclickerX2()">–ö—É–ø–∏—Ç—å</button>
        </div>
    </div>

    <div id="achievement" class="achievement">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: 100 –∫–ª–∏–∫–æ–≤!</div>

    <script>
        let count = 0;
        let level = 1;
        let perClick = 1;
        let autoClick = 0;
        let multiplier = 1;
        let talentPoints = 0;
        let skillPoints = 0;
        let achievements = [100, 500, 1000, 5000];
        let unlocked = new Set();
        let currentSkin = 0;
        let currentGalaxy = 0;

        // –ì–∞–ª–∞–∫—Ç–∏–∫–∏
        const galaxies = [
            { name: "–ú–ª–µ—á–Ω—ã–π –ü—É—Ç—å", bg: "linear-gradient(135deg, #0f0c29, #302b63, #24243e)", bonus: 1 },
            { name: "–ê–Ω–¥—Ä–æ–º–µ–¥–∞", bg: "linear-gradient(135deg, #2c003e, #570a57, #8b008b)", bonus: 1.1 },
            { name: "–¢—É–º–∞–Ω–Ω–æ—Å—Ç—å –û—Ä–∏–æ–Ω–∞", bg: "linear-gradient(135deg, #000428, #004e92)", bonus: 1.2 }
        ];

        // –£–º–µ–Ω–∏—è
        let skills = {
            clickBonus: { level: 0, value: 0.1 },
            autoBonus: { level: 0, value: 0.5 },
            multiplier: { level: 0, value: 2, duration: 10 }
        };

        // –°—é–∂–µ—Ç
        let story = {
            location: "–ó–µ–º–ª—è",
            enemy: "–ê—Å—Ç–µ—Ä–æ–∏–¥",
            stage: 0,
            requiredScore: 1000, // –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞
            path: null // "moon" –∏–ª–∏ "mars"
        };

        // –¢–∞–ª–∞–Ω—Ç—ã
        let talents = {
            clickBonus: { level: 0, value: 0.01 },
            autoBonus: { level: 0, value: 0.5 },
            levelBonus: { level: 0, value: 1.1 }
        };

        // –ë–∞—Ñ—Ñ—ã
        let buffs = [];

        // –ö–≤–µ—Å—Ç—ã
        let quests = [
            { id: 1, text: "–ù–∞–±–µ—Ä–∏ 100 –æ—á–∫–æ–≤", target: 100, progress: 0, reward: 50, completed: false },
            { id: 2, text: "–°–¥–µ–ª–∞–π 20 –∫–ª–∏–∫–æ–≤", target: 20, progress: 0, reward: 30, completed: false },
            { id: 3, text: "–ö—É–ø–∏ 3 —É–ª—É—á—à–µ–Ω–∏—è", target: 3, progress: 0, reward: 40, completed: false }
        ];

        // –°–ª—É—á–∞–π–Ω—ã–π –∫–≤–µ—Å—Ç
        let randomQuest = null;
        let lastRandomQuestTime = 0;

        // –°–∫–∏–Ω—ã (—Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏)
        const skins = [
            { name: "–°—Ç–∞–Ω–¥–∞—Ä—Ç", gradient: "linear-gradient(145deg, #ffcc00, #ff9800)", animation: "" },
            { name: "–õ–µ–¥—è–Ω–æ–π", gradient: "linear-gradient(145deg, #00ffff, #00aaff)", animation: "glow" },
            { name: "–ü–ª–∞–º—è", gradient: "linear-gradient(145deg, #ff3300, #ff9900)", animation: "pulse" },
            { name: "–ó–µ–ª—ë–Ω—ã–π", gradient: "linear-gradient(145deg, #33cc33, #99ff33)", animation: "spin" },
            { name: "–§–∏–æ–ª–µ—Ç–æ–≤—ã–π", gradient: "linear-gradient(145deg, #cc00ff, #6600ff)", animation: "glow pulse" },
            { name: "–ó–æ–ª–æ—Ç–æ–π", gradient: "linear-gradient(145deg, gold, orange)", animation: "pulse" }, // 1 –º–µ—Å—Ç–æ
            { name: "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π", gradient: "linear-gradient(145deg, silver, lightgray)", animation: "glow" }, // 2 –º–µ—Å—Ç–æ
            { name: "–ë—Ä–æ–Ω–∑–æ–≤—ã–π", gradient: "linear-gradient(145deg, #cd7f32, #a67b5b)", animation: "glow" }, // 3 –º–µ—Å—Ç–æ
            { name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π", gradient: "linear-gradient(145deg, #000000, #4b6cb7)", animation: "spin" }, // –°–µ–∑–æ–Ω–Ω—ã–π
            { name: "–õ—É–Ω–Ω—ã–π", gradient: "linear-gradient(145deg, #a9a9a9, #d3d3d3)", animation: "glow" }, // –ó–∞ –ª–æ–∫–∞—Ü–∏—é –õ—É–Ω–∞
            { name: "–ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π", gradient: "linear-gradient(145deg, #ff4500, #8b0000)", animation: "pulse" }, // –ó–∞ –ª–æ–∫–∞—Ü–∏—é –ú–∞—Ä—Å
            { name: "–ë–æ—Å—Å", gradient: "linear-gradient(145deg, #4b0082, #000000)", animation: "spin" }, // –ó–∞ –ø–æ–±–µ–¥—É –Ω–∞–¥ –±–æ—Å—Å–æ–º
            { name: "–¢–µ–º–Ω—ã–π", gradient: "linear-gradient(145deg, #000000, #4b0082)", animation: "spin" }, // –ó–∞ –¢–µ–º–Ω—É—é –ú–∞—Ç–µ—Ä–∏—é
            { name: "–ö–≤–∞–∑–∞—Ä–Ω—ã–π", gradient: "linear-gradient(145deg, #0000ff, #00ffff)", animation: "glow" }, // –ó–∞ –ö–≤–∞–∑–∞—Ä
            { name: "–í—Ä–µ–º–µ–Ω–Ω–æ–π", gradient: "linear-gradient(145deg, #ffffff, #c0c0c0)", animation: "pulse" }, // –ó–∞ –ö–æ—Ä–∏–¥–æ—Ä –í—Ä–µ–º–µ–Ω–∏
            { name: "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π", gradient: "linear-gradient(145deg, #808080, #a9a9a9)", animation: "glow" } // –ó–∞ –ì–∞–ª–∞–∫—Ç–∏–∫—É –ü—Ä–∏–∑—Ä–∞–∫–æ–≤
        ];

        // –°–µ–∑–æ–Ω—ã
        const seasons = [
            { name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –û—Ö–æ—Ç–∞", duration: 7, start: new Date("2025-11-15"), active: false },
            { name: "–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ì–æ–Ω–∫–∏", duration: 7, start: new Date("2025-11-22"), active: false }
        ];

        // –°—Ä–∞–∂–µ–Ω–∏–µ
        let battle = {
            active: false,
            clicksLeft: 10,
            timeLeft: 10,
            enemy: "–ê—Å—Ç–µ—Ä–æ–∏–¥",
            reward: 500
        };

        // –í—Ä–∞–≥–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤, –≤—Ä–µ–º—è, –Ω–∞–≥—Ä–∞–¥–∞)
        const enemies = {
            "–ê—Å—Ç–µ—Ä–æ–∏–¥": { clicks: 10, time: 10, reward: "points" },
            "–ü–∏—Ä–∞—Ç": { clicks: 15, time: 15, reward: "buff" },
            "–ë–æ—Å—Å": { clicks: 20, time: 10, reward: "skin" },
            "–¢–µ–º–Ω–∞—è –ú–∞—Ç–µ—Ä–∏—è": { clicks: 30, time: 10, reward: "skin" },
            "–ö–≤–∞–∑–∞—Ä": { clicks: 40, time: 15, reward: "skin" },
            "–ö–æ—Ä–∏–¥–æ—Ä –í—Ä–µ–º–µ–Ω–∏": { clicks: 50, time: 20, reward: "skin" },
            "–ì–∞–ª–∞–∫—Ç–∏–∫–∞ –ü—Ä–∏–∑—Ä–∞–∫–æ–≤": { clicks: 60, time: 25, reward: "skin" }
        };

        // –°–æ–∑–¥–∞—ë–º –∑–≤—É–∫–∏
        const clickSound = new Audio("audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");
        const purchaseSound = new Audio("audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");
        const achievementSound = new Audio("audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        window.onload = function () {
            const saved = JSON.parse(localStorage.getItem('clickerSave'));
            if (saved) {
                count = saved.count || 0;
                level = saved.level || 1;
                perClick = saved.perClick || 1;
                autoClick = saved.autoClick || 0;
                multiplier = saved.multiplier || 1;
                talentPoints = saved.talentPoints || 0;
                skillPoints = saved.skillPoints || 0;
                currentSkin = saved.currentSkin || 0;
                currentGalaxy = saved.currentGalaxy || 0;
                story = saved.story || story;
                battle = saved.battle || battle;
                quests = saved.quests || quests;
                talents = saved.talents || talents;
                skills = saved.skills || skills;
                unlocked = new Set(saved.unlocked || []);
                buffs = saved.buffs || [];
                lastRandomQuestTime = saved.lastRandomQuestTime || 0;
                randomQuest = saved.randomQuest || null;
                document.getElementById("counter").innerText = count;
                document.getElementById("level").innerText = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
                document.getElementById("talentPoints").innerText = `–û—á–∫–∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤: ${talentPoints}`;
                document.getElementById("skillPoints").innerText = `–û—á–∫–∏ —É–º–µ–Ω–∏–π: ${skillPoints}`;
                document.getElementById("perClick").innerText = perClick.toFixed(2);
                document.getElementById("autoClick").innerText = autoClick.toFixed(2);
                applySkin();
                updateBuffsDisplay();
                updateQuestsDisplay();
                updateTalentTree();
                updateRandomQuest();
                applyGalaxy();
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                document.getElementById("send-to-chat-btn").style.display = "inline-block";
                document.getElementById("leaderboard-btn").style.display = "inline-block";
                window.Telegram.WebApp.onEvent("dataReceive", (eventData) => {
                    if (eventData.data.startsWith("leaderboard:")) {
                        const data = JSON.parse(eventData.data.replace("leaderboard:", ""));
                        showLeaderboard(data);
                    }
                });
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ–∑–æ–Ω
            checkSeason();
        };

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∏–Ω
        function applySkin() {
            const skin = skins[currentSkin];
            const button = document.getElementById("clicker");
            button.style.background = skin.gradient;
            button.style.animation = skin.animation ? `${skin.animation} 2s infinite` : "none";
        }

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥–∞–ª–∞–∫—Ç–∏–∫—É
        function applyGalaxy() {
            const galaxy = galaxies[currentGalaxy];
            document.body.style.background = galaxy.bg;
            showAchievement(`üåå –í—ã –≤ –≥–∞–ª–∞–∫—Ç–∏–∫–µ: ${galaxy.name}!`);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∑–æ–Ω–∞
        function checkSeason() {
            const today = new Date();
            for (let i = 0; i < seasons.length; i++) {
                const start = new Date(seasons[i].start);
                const end = new Date(start);
                end.setDate(start.getDate() + seasons[i].duration);

                if (today >= start && today < end) {
                    seasons[i].active = true;
                    document.getElementById("season").style.display = "block";
                    showAchievement(`üéâ –°–µ–∑–æ–Ω: ${seasons[i].name} –∞–∫—Ç–∏–≤–µ–Ω!`);
                    if (currentSkin < 8) {
                        currentSkin = 8; // –°–µ–∑–æ–Ω–Ω—ã–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üéÅ –°–µ–∑–æ–Ω–Ω—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
                    }
                    return;
                }
            }
            document.getElementById("season").style.display = "none";
        }

        // –û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        function openStory() {
            document.getElementById("story").style.display = "block";
        }

        // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        function nextStory() {
            if (count < story.requiredScore) {
                showAchievement(`–ù—É–∂–Ω–æ ${story.requiredScore} –æ—á–∫–æ–≤, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å!`);
                return;
            }

            if (story.stage === 0) {
                // –í—ã–±–æ—Ä: –õ—É–Ω–∞ –∏–ª–∏ –ú–∞—Ä—Å
                document.getElementById("story").innerHTML = `
                    <p>üåå –í—ã –ø–æ–∫–∏–¥–∞–µ—Ç–µ –ó–µ–º–ª—é. –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–º—Å—è?</p>
                    <button class="story-btn" onclick="choosePath('moon')">üöÄ –õ—É–Ω–∞</button>
                    <button class="story-btn" onclick="choosePath('mars')">üî¥ –ú–∞—Ä—Å</button>
                `;
                return;
            }

            if (story.stage === 1) {
                if (story.path === "moon") {
                    story.location = "–õ—É–Ω–∞";
                    story.enemy = "–ü–∏—Ä–∞—Ç";
                    story.requiredScore = 5000;
                    if (currentSkin < 9) {
                        currentSkin = 9; // –õ—É–Ω–Ω—ã–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üåï –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –õ—É–Ω–Ω—ã–π!");
                    }
                    showAchievement("üåå –í—ã –ø—Ä–∏–±—ã–ª–∏ –Ω–∞ –õ—É–Ω—É. –í—Ä–∞–≥: –ü–∏—Ä–∞—Ç");
                } else if (story.path === "mars") {
                    story.location = "–ú–∞—Ä—Å";
                    story.enemy = "–ë–æ—Å—Å";
                    story.requiredScore = 10000;
                    if (currentSkin < 10) {
                        currentSkin = 10; // –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üî¥ –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –ú–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–π!");
                    }
                    showAchievement("üåå –í—ã –ø—Ä–∏–±—ã–ª–∏ –Ω–∞ –ú–∞—Ä—Å. –í—Ä–∞–≥: –ë–æ—Å—Å");
                }
            } else if (story.stage === 2) {
                story.location = "–ö–≤–∞–∑–∞—Ä";
                story.enemy = "–¢–µ–º–Ω–∞—è –ú–∞—Ç–µ—Ä–∏—è";
                story.requiredScore = 20000;
                if (currentSkin < 11) {
                    currentSkin = 11; // –ë–æ—Å—Å-—Å–∫–∏–Ω
                    applySkin();
                    showAchievement("üëæ –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –ë–æ—Å—Å!");
                }
                showAchievement("üåå –í—ã –ø—Ä–∏–±—ã–ª–∏ –≤ –ö–≤–∞–∑–∞—Ä. –í—Ä–∞–≥: –¢–µ–º–Ω–∞—è –ú–∞—Ç–µ—Ä–∏—è");
            } else if (story.stage === 3) {
                story.location = "–ö–≤–∞–∑–∞—Ä";
                story.enemy = "–ö–≤–∞–∑–∞—Ä";
                story.requiredScore = 50000;
                if (currentSkin < 12) {
                    currentSkin = 12; // –¢–µ–º–Ω—ã–π —Å–∫–∏–Ω
                    applySkin();
                    showAchievement("üåå –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –¢–µ–º–Ω—ã–π!");
                }
                showAchievement("üåå –í—ã –≤ –ö–≤–∞–∑–∞—Ä–µ. –í—Ä–∞–≥: –ö–≤–∞–∑–∞—Ä");
            } else if (story.stage === 4) {
                story.location = "–ö–æ—Ä–∏–¥–æ—Ä –í—Ä–µ–º–µ–Ω–∏";
                story.enemy = "–ö–æ—Ä–∏–¥–æ—Ä –í—Ä–µ–º–µ–Ω–∏";
                story.requiredScore = 100000;
                if (currentSkin < 13) {
                    currentSkin = 13; // –ö–≤–∞–∑–∞—Ä–Ω—ã–π —Å–∫–∏–Ω
                    applySkin();
                    showAchievement("üåå –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –ö–≤–∞–∑–∞—Ä–Ω—ã–π!");
                }
                showAchievement("üåå –í—ã –≤ –ö–æ—Ä–∏–¥–æ—Ä–µ –í—Ä–µ–º–µ–Ω–∏. –í—Ä–∞–≥: –ö–æ—Ä–∏–¥–æ—Ä –í—Ä–µ–º–µ–Ω–∏");
            } else if (story.stage === 5) {
                story.location = "–ì–∞–ª–∞–∫—Ç–∏–∫–∞ –ü—Ä–∏–∑—Ä–∞–∫–æ–≤";
                story.enemy = "–ì–∞–ª–∞–∫—Ç–∏–∫–∞ –ü—Ä–∏–∑—Ä–∞–∫–æ–≤";
                story.requiredScore = 200000;
                if (currentSkin < 14) {
                    currentSkin = 14; // –í—Ä–µ–º–µ–Ω–Ω–æ–π —Å–∫–∏–Ω
                    applySkin();
                    showAchievement("üåå –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –í—Ä–µ–º–µ–Ω–Ω–æ–π!");
                }
                showAchievement("üåå –í—ã –≤ –ì–∞–ª–∞–∫—Ç–∏–∫–µ –ü—Ä–∏–∑—Ä–∞–∫–æ–≤. –í—Ä–∞–≥: –ì–∞–ª–∞–∫—Ç–∏–∫–∞ –ü—Ä–∏–∑—Ä–∞–∫–æ–≤");
            } else if (story.stage === 6) {
                story.location = "–§–∏–Ω–∞–ª";
                story.enemy = "–§–∏–Ω–∞–ª";
                story.requiredScore = Infinity; // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç
                if (currentSkin < 15) {
                    currentSkin = 15; // –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π —Å–∫–∏–Ω
                    applySkin();
                    showAchievement("üåå –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π!");
                }
                showAchievement("üåå –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ –∏–≥—Ä—É!");
                story.stage = 0;
                story.path = null;
            }

            document.getElementById("story").innerHTML = `
                <p>üåå –°—é–∂–µ—Ç: –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –ó–µ–º–ª—é –æ—Ç —Ç–µ–º–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∏.</p>
                <p>üìç –õ–æ–∫–∞—Ü–∏—è: ${story.location}</p>
                <p>üëæ –í—Ä–∞–≥: ${story.enemy}</p>
                <p>üéØ –ó–∞–¥–∞–Ω–∏–µ: –Ω–∞–±–µ—Ä–∏—Ç–µ ${story.requiredScore} –æ—á–∫–æ–≤</p>
                <button class="story-btn" onclick="startBattle()">–°—Ä–∞–∂–µ–Ω–∏–µ</button>
            `;
            story.stage++;
        }

        // –ù–∞—á–∞—Ç—å —Å—Ä–∞–∂–µ–Ω–∏–µ
        function startBattle() {
            battle.active = true;
            battle.enemy = story.enemy;
            const enemyData = enemies[battle.enemy];
            battle.clicksLeft = enemyData.clicks;
            battle.timeLeft = enemyData.time;
            document.getElementById("battle-enemy").innerText = battle.enemy;
            document.getElementById("clicks-left").innerText = battle.clicksLeft;
            document.getElementById("time-left-battle").innerText = battle.timeLeft;
            document.getElementById("battle").style.display = "block";
            document.getElementById("clicker").onclick = clickBattle;
            showAchievement(`‚öîÔ∏è –°—Ä–∞–∂–µ–Ω–∏–µ —Å ${battle.enemy} –Ω–∞—á–∞—Ç–æ!`);
        }

        // –ö–ª–∏–∫ –≤ —Å—Ä–∞–∂–µ–Ω–∏–∏
        function clickBattle() {
            if (!battle.active) return;
            battle.clicksLeft--;
            document.getElementById("clicks-left").innerText = battle.clicksLeft;
            if (battle.clicksLeft <= 0) {
                // –ü–æ–±–µ–¥–∞
                const enemyData = enemies[battle.enemy];
                if (enemyData.reward === "points") {
                    count += 500;
                    document.getElementById("counter").innerText = count;
                    showAchievement(`üéâ –ü–æ–±–µ–¥–∞! –ù–∞–≥—Ä–∞–¥–∞: 500 –æ—á–∫–æ–≤!`);
                } else if (enemyData.reward === "buff") {
                    addBuff("multiplier", 2, 30);
                    showAchievement(`üéâ –ü–æ–±–µ–¥–∞! –ù–∞–≥—Ä–∞–¥–∞: x2 –Ω–∞ 30 —Å–µ–∫!`);
                } else if (enemyData.reward === "skin") {
                    if (battle.enemy === "–¢–µ–º–Ω–∞—è –ú–∞—Ç–µ—Ä–∏—è" && currentSkin < 12) {
                        currentSkin = 12; // –¢–µ–º–Ω—ã–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üéâ –ü–æ–±–µ–¥–∞! –ù–∞–≥—Ä–∞–¥–∞: –Ω–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
                    } else if (battle.enemy === "–ö–≤–∞–∑–∞—Ä" && currentSkin < 13) {
                        currentSkin = 13; // –ö–≤–∞–∑–∞—Ä–Ω—ã–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üéâ –ü–æ–±–µ–¥–∞! –ù–∞–≥—Ä–∞–¥–∞: –Ω–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
                    } else if (battle.enemy === "–ö–æ—Ä–∏–¥–æ—Ä –í—Ä–µ–º–µ–Ω–∏" && currentSkin < 14) {
                        currentSkin = 14; // –í—Ä–µ–º–µ–Ω–Ω–æ–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üéâ –ü–æ–±–µ–¥–∞! –ù–∞–≥—Ä–∞–¥–∞: –Ω–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
                    } else if (battle.enemy === "–ì–∞–ª–∞–∫—Ç–∏–∫–∞ –ü—Ä–∏–∑—Ä–∞–∫–æ–≤" && currentSkin < 15) {
                        currentSkin = 15; // –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π —Å–∫–∏–Ω
                        applySkin();
                        showAchievement("üéâ –ü–æ–±–µ–¥–∞! –ù–∞–≥—Ä–∞–¥–∞: –Ω–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!");
                    }
                }
                document.getElementById("battle").style.display = "none";
                document.getElementById("clicker").onclick = clickCounter;
                battle.active = false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è
        setInterval(() => {
            if (battle.active) {
                battle.timeLeft--;
                document.getElementById("time-left-battle").innerText = battle.timeLeft;
                if (battle.timeLeft <= 0) {
                    // –ü–æ—Ä–∞–∂–µ–Ω–∏–µ
                    document.getElementById("battle").style.display = "none";
                    document.getElementById("clicker").onclick = clickCounter;
                    showAchievement(`üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`);
                    battle.active = false;
                }
            }
        }, 1000);

        // –í—ã–±—Ä–∞—Ç—å –ø—É—Ç—å
        function choosePath(path) {
            story.path = path;
            story.stage = 1;
            nextStory();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã
        function checkDailyReward() {
            const today = new Date().toDateString();
            const lastLogin = localStorage.getItem('lastLogin');
            if (lastLogin !== today) {
                document.getElementById("daily-reward").style.display = "block";
            } else {
                document.getElementById("daily-reward").style.display = "none";
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É
        function claimDaily() {
            const rewards = [
                { type: "points", amount: 100, text: "+100 –æ—á–∫–æ–≤!" },
                { type: "multiplier", amount: 2, duration: 30, text: "x2 –Ω–∞ 30 —Å–µ–∫!" },
                { type: "click", amount: 5, duration: 20, text: "+5 –∑–∞ –∫–ª–∏–∫ –Ω–∞ 20 —Å–µ–∫!" },
                { type: "auto", amount: 1, duration: 60, text: "+1 –∞–≤—Ç–æ–∫–ª–∏–∫ –Ω–∞ 60 —Å–µ–∫!" }
            ];

            const reward = rewards[Math.floor(Math.random() * rewards.length)];
            document.getElementById("daily-text").innerText = reward.text;

            if (reward.type === "points") {
                count += reward.amount;
                document.getElementById("counter").innerText = count;
            } else if (reward.type === "multiplier") {
                addBuff("multiplier", reward.amount, reward.duration);
            } else if (reward.type === "click") {
                addBuff("click", reward.amount, reward.duration);
            } else if (reward.type === "auto") {
                addBuff("auto", reward.amount, reward.duration);
            }

            localStorage.setItem('lastLogin', new Date().toDateString());
            document.getElementById("daily-reward").style.display = "none";
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ñ—Ñ–∞
        function addBuff(type, amount, duration) {
            const buff = { type, amount, duration, id: Date.now() };
            buffs.push(buff);
            updateBuffsDisplay();

            setTimeout(() => {
                buffs = buffs.filter(b => b.id !== buff.id);
                updateBuffsDisplay();
            }, duration * 1000);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∞—Ñ—Ñ–æ–≤
        function updateBuffsDisplay() {
            const activeBuffs = document.getElementById("active-buffs");
            activeBuffs.innerHTML = "";

            buffs.forEach(buff => {
                const div = document.createElement("div");
                div.innerText = `${getBuffText(buff.type)}: ${buff.amount} (${buff.duration} —Å–µ–∫)`;
                activeBuffs.appendChild(div);
            });
        }

        // –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ñ—Ñ–∞
        function getBuffText(type) {
            if (type === "multiplier") return "–ú–Ω–æ–∂–∏—Ç–µ–ª—å";
            if (type === "click") return "–ö–ª–∏–∫";
            if (type === "auto") return "–ê–≤—Ç–æ–∫–ª–∏–∫";
            if (type === "shield") return "–©–∏—Ç";
            return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π";
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤
        function updateQuestsDisplay() {
            const activeQuests = document.getElementById("active-quests");
            activeQuests.innerHTML = "";

            quests.forEach(quest => {
                if (!quest.completed) {
                    const div = document.createElement("div");
                    div.innerText = `${quest.text}: ${quest.progress}/${quest.target}`;
                    activeQuests.appendChild(div);
                }
            });

            if (randomQuest && !randomQuest.completed) {
                const div = document.createElement("div");
                div.innerText = `üé≤ –°–ª—É—á–∞–π–Ω—ã–π: ${randomQuest.text}: ${randomQuest.progress}/${randomQuest.target}`;
                activeQuests.appendChild(div);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤
        function checkQuests() {
            quests.forEach(quest => {
                if (!quest.completed && quest.progress >= quest.target) {
                    quest.completed = true;
                    count += quest.reward;
                    document.getElementById("counter").innerText = count;
                    showAchievement(`–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! –ù–∞–≥—Ä–∞–¥–∞: ${quest.reward} –æ—á–∫–æ–≤`);
                }
            });

            if (randomQuest && !randomQuest.completed && randomQuest.progress >= randomQuest.target) {
                randomQuest.completed = true;
                count += randomQuest.reward;
                document.getElementById("counter").innerText = count;
                showAchievement(`–°–ª—É—á–∞–π–Ω—ã–π –∫–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! –ù–∞–≥—Ä–∞–¥–∞: ${randomQuest.reward} –æ—á–∫–æ–≤`);
                randomQuest = null;
            }

            updateQuestsDisplay();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞
        function generateRandomQuest() {
            const now = Date.now();
            const fiveMinutes = 5 * 60 * 1000;

            if (now - lastRandomQuestTime > fiveMinutes) {
                const questTypes = [
                    { text: "–ö–ª–∏–∫–Ω–∏ 50 —Ä–∞–∑", target: 50, reward: 100 },
                    { text: "–ù–∞–±–µ—Ä–∏ 500 –æ—á–∫–æ–≤", target: 500, reward: 150 },
                    { text: "–ö—É–ø–∏ 5 —É–ª—É—á—à–µ–Ω–∏–π", target: 5, reward: 120 }
                ];
                const quest = questTypes[Math.floor(Math.random() * questTypes.length)];
                randomQuest = { ...quest, progress: 0, completed: false, id: "random" };
                lastRandomQuestTime = now;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞
        function updateRandomQuest() {
            generateRandomQuest();
            updateQuestsDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ç–∞–ª–∞–Ω—Ç–æ–≤ –∏ SVG
        function updateTalentTree() {
            const clickNode = document.getElementById("talent-click");
            const autoNode = document.getElementById("talent-auto");
            const levelNode = document.getElementById("talent-level");

            // –ö–ª–∏–∫
            if (talents.clickBonus.level > 0) {
                clickNode.classList.add("active");
            }

            // –ê–≤—Ç–æ (—Ç—Ä–µ–±—É–µ—Ç –∫–ª–∏–∫)
            if (talents.autoBonus.level > 0) {
                autoNode.classList.add("active");
            } else if (talents.clickBonus.level === 0) {
                autoNode.classList.add("locked");
            } else {
                autoNode.classList.remove("locked");
            }

            // –£—Ä–æ–≤–µ–Ω—å (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ)
            if (talents.levelBonus.level > 0) {
                levelNode.classList.add("active");
            } else if (talents.autoBonus.level === 0) {
                levelNode.classList.add("locked");
            } else {
                levelNode.classList.remove("locked");
            }

            drawTalentConnections();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ SVG-–ª–∏–Ω–∏–π –º–µ–∂–¥—É —Ç–∞–ª–∞–Ω—Ç–∞–º–∏
        function drawTalentConnections() {
            const svg = document.getElementById("talent-connections");
            svg.innerHTML = "";

            // –ü–æ–∑–∏—Ü–∏–∏ —É–∑–ª–æ–≤ (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
            const clickX = 50;
            const autoX = 150;
            const levelX = 250;
            const y = 50;

            // –õ–∏–Ω–∏—è: –ö–ª–∏–∫ -> –ê–≤—Ç–æ
            if (talents.clickBonus.level > 0) {
                const line1 = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line1.setAttribute("x1", clickX + 40);
                line1.setAttribute("y1", y);
                line1.setAttribute("x2", autoX - 40);
                line1.setAttribute("y2", y);
                line1.setAttribute("stroke", "white");
                line1.setAttribute("stroke-width", "2");
                svg.appendChild(line1);
            }

            // –õ–∏–Ω–∏—è: –ê–≤—Ç–æ -> –£—Ä–æ–≤–µ–Ω—å
            if (talents.autoBonus.level > 0) {
                const line2 = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line2.setAttribute("x1", autoX + 40);
                line2.setAttribute("y1", y);
                line2.setAttribute("x2", levelX - 40);
                line2.setAttribute("y2", y);
                line2.setAttribute("stroke", "white");
                line2.setAttribute("stroke-width", "2");
                svg.appendChild(line2);
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–∞–ª–∞–Ω—Ç–∞
        function animateTalent(nodeId) {
            const node = document.getElementById(nodeId);
            node.classList.add("pulse");
            setTimeout(() => {
                node.classList.remove("pulse");
            }, 500);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
        function checkLevel() {
            const newLevel = Math.floor(Math.sqrt(count / 100)) + 1;
            if (newLevel > level) {
                level = newLevel;
                perClick += 1; // –ë–æ–Ω—É—Å –∑–∞ —É—Ä–æ–≤–µ–Ω—å
                document.getElementById("level").innerText = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
                document.getElementById("perClick").innerText = perClick.toFixed(2);

                // –û—á–∫–∏ —É–º–µ–Ω–∏–π –∑–∞ —É—Ä–æ–≤–µ–Ω—å
                if (level % 3 === 0) {
                    skillPoints++;
                    document.getElementById("skillPoints").innerText = `–û—á–∫–∏ —É–º–µ–Ω–∏–π: ${skillPoints}`;
                    showAchievement(`üß† –ü–æ–ª—É—á–µ–Ω–æ –æ—á–∫–æ —É–º–µ–Ω–∏—è!`);
                }

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫–∏–Ω–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å
                if (level % 3 === 0 && currentSkin < skins.length - 1) {
                    currentSkin++;
                    applySkin();
                    showAchievement(`–ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
                }

                // –û—á–∫–∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤ –∑–∞ —É—Ä–æ–≤–µ–Ω—å
                if (level % 5 === 0) {
                    talentPoints++;
                    document.getElementById("talentPoints").innerText = `–û—á–∫–∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤: ${talentPoints}`;
                }

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≥–∞–ª–∞–∫—Ç–∏–∫–∏ –∑–∞ —É—Ä–æ–≤–µ–Ω—å
                if (level % 10 === 0 && currentGalaxy < galaxies.length - 1) {
                    currentGalaxy++;
                    applyGalaxy();
                    showAchievement(`–ù–æ–≤–∞—è –≥–∞–ª–∞–∫—Ç–∏–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞: ${galaxies[currentGalaxy].name}!`);
                }
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≥–∞–ª–∞–∫—Ç–∏–∫—É
        function switchGalaxy() {
            if (currentGalaxy < galaxies.length - 1) {
                currentGalaxy++;
            } else {
                currentGalaxy = 0;
            }
            applyGalaxy();
        }

        // –ü–æ–∫—É–ø–∫–∞ —É–º–µ–Ω–∏—è
        function buySkill(type) {
            let cost = 1;
            if (type === "multiplier") cost = 3;

            if (skillPoints >= cost) {
                skillPoints -= cost;
                skills[type].level++;
                document.getElementById("skillPoints").innerText = `–û—á–∫–∏ —É–º–µ–Ω–∏–π: ${skillPoints}`;
                showAchievement(`üß† –£–º–µ–Ω–∏–µ "${type}" —É–ª—É—á—à–µ–Ω–æ!`);
            }
        }

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–º–µ–Ω–∏–µ
        function useSkill(type) {
            if (skillPoints >= 3) {
                skillPoints -= 3;
                document.getElementById("skillPoints").innerText = `–û—á–∫–∏ —É–º–µ–Ω–∏–π: ${skillPoints}`;
                if (type === "multiplier") {
                    addBuff("multiplier", skills[type].value, skills[type].duration);
                    showAchievement(`‚ö° –£–º–µ–Ω–∏–µ "${type}" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ!`);
                }
            } else {
                showAchievement("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ —É–º–µ–Ω–∏–π!");
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ —Ç–∞–ª–∞–Ω—Ç–∞
        function buyTalent(type) {
            let cost = 1;
            if (type === "levelBonus") cost = 2;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
            if (type === "autoBonus" && talents.clickBonus.level === 0) {
                showAchievement("–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫–∞—á–∞–π '–ö–ª–∏–∫'!");
                return;
            }
            if (type === "levelBonus" && talents.autoBonus.level === 0) {
                showAchievement("–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫–∞—á–∞–π '–ê–≤—Ç–æ'!");
                return;
            }

            if (talentPoints >= cost) {
                talentPoints -= cost;
                talents[type].level++;
                document.getElementById("talentPoints").innerText = `–û—á–∫–∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤: ${talentPoints}`;
                updateTalentTree();

                // –ê–Ω–∏–º–∞—Ü–∏—è
                let nodeId;
                if (type === "clickBonus") nodeId = "talent-click";
                if (type === "autoBonus") nodeId = "talent-auto";
                if (type === "levelBonus") nodeId = "talent-level";
                animateTalent(nodeId);
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–ª–∞–Ω—Ç–æ–≤
        function applyTalents() {
            perClick += talents.clickBonus.level * talents.clickBonus.value;
            autoClick += talents.autoBonus.level * talents.autoBonus.value;
            multiplier = 1 + talents.levelBonus.level * (talents.levelBonus.value - 1);
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É–º–µ–Ω–∏–π
        function applySkills() {
            perClick += skills.clickBonus.level * skills.clickBonus.value;
            autoClick += skills.autoBonus.level * skills.autoBonus.value;
        }

        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        function shareResult() {
            const url = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=üöÄ –Ø –Ω–∞–±—Ä–∞–ª ${count} –æ—á–∫–æ–≤ –≤ Clicker Adventure! –ü–æ–ø—Ä–æ–±—É–π –ø–æ–±–∏—Ç—å –º–µ–Ω—è!`;
            window.open(url, '_blank');
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —á–∞—Ç (Telegram WebApp)
        function sendResultToChat() {
            if (window.Telegram && window.Telegram.WebApp) {
                const webApp = window.Telegram.WebApp;
                const user = webApp.initDataUnsafe?.user;
                if (user) {
                    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                    const data = {
                        userId: user.id,
                        score: count,
                        level: level,
                        talentPoints: talentPoints
                    };
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥
                    webApp.sendData(JSON.stringify(data));
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    webApp.showAlert(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç ${count} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`);
                } else {
                    showAchievement("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.");
                }
            } else {
                showAchievement("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Telegram Mini App.");
            }
        }

        // –ó–∞–ø—Ä–æ—Å–∏—Ç—å leaderboard (—Ñ–µ–π–∫–æ–≤—ã–π)
        function requestLeaderboard() {
            if (window.Telegram && window.Telegram.WebApp) {
                const fakeLeaderboard = [
                    { userId: 111111111, username: "Player1", score: 10000 },
                    { userId: 222222222, username: "Player2", score: 9500 },
                    { userId: 333333333, username: "Player3", score: 9000 },
                    { userId: 444444444, username: "Player4", score: 8500 },
                    { userId: 555555555, username: "Player5", score: 8000 }
                ];

                const webApp = window.Telegram.WebApp;
                const user = webApp.initDataUnsafe?.user;
                if (user && !fakeLeaderboard.some(p => p.userId === user.id)) {
                    fakeLeaderboard.push({ userId: user.id, username: user.username || `ID: ${user.id}`, score: count });
                    fakeLeaderboard.sort((a, b) => b.score - a.score);
                    if (fakeLeaderboard.length > 5) {
                        fakeLeaderboard.length = 5;
                    }
                }

                webApp.sendData("leaderboard:" + JSON.stringify(fakeLeaderboard));
            } else {
                showAchievement("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Telegram Mini App.");
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å leaderboard
        function showLeaderboard(data) {
            const list = document.getElementById("leaderboard-list");
            list.innerHTML = "";

            data.forEach((entry, index) => {
                const div = document.createElement("div");
                div.innerText = `#${index + 1} ‚Äî ${entry.username || `ID: ${entry.userId}`} ‚Äî ${entry.score} –æ—á–∫–æ–≤`;
                list.appendChild(div);

                if (entry.userId === window.Telegram.WebApp?.initDataUnsafe?.user?.id) {
                    if (index === 0) {
                        if (currentSkin < 5) {
                            currentSkin = 5;
                            applySkin();
                            showAchievement("üèÜ –í—ã –≤ 1-—Ö –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ! –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –ó–æ–ª–æ—Ç–æ–π!");
                        }
                    } else if (index === 1) {
                        if (currentSkin < 6) {
                            currentSkin = 6;
                            applySkin();
                            showAchievement("ü•à –í—ã –≤ —Ç–æ–ø-2! –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –°–µ—Ä–µ–±—Ä—è–Ω—ã–π!");
                        }
                    } else if (index === 2) {
                        if (currentSkin < 7) {
                            currentSkin = 7;
                            applySkin();
                            showAchievement("ü•â –í—ã –≤ —Ç–æ–ø-3! –ù–æ–≤—ã–π —Å–∫–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: –ë—Ä–æ–Ω–∑–æ–≤—ã–π!");
                        }
                    }
                }
            });

            document.getElementById("leaderboard").style.display = "block";
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Ä—É–ª–µ—Ç–∫—É
        function openWheel() {
            document.getElementById("wheel-container").style.display = "block";
        }

        // –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É
        function spinWheel() {
            const today = new Date().toDateString();
            const lastSpin = localStorage.getItem('lastSpin');
            if (lastSpin === today) {
                showAchievement("–†—É–ª–µ—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ä–∞–∑ –≤ –¥–µ–Ω—å!");
                return;
            }

            const wheel = document.getElementById("wheel");
            const spinValue = Math.floor(Math.random() * 360) + 3600; // 10 –æ–±–æ—Ä–æ—Ç–æ–≤
            wheel.style.transform = `rotate(${spinValue}deg)`;

            setTimeout(() => {
                const rewards = [
                    { type: "points", amount: 200, text: "+200 –æ—á–∫–æ–≤!" },
                    { type: "multiplier", amount: 2, duration: 30, text: "x2 –Ω–∞ 30 —Å–µ–∫!" },
                    { type: "skin", amount: 5, text: "–ù–æ–≤—ã–π —Å–∫–∏–Ω!" },
                    { type: "galaxy", amount: 1, text: "–ù–æ–≤–∞—è –≥–∞–ª–∞–∫—Ç–∏–∫–∞!" }
                ];
                const reward = rewards[Math.floor(Math.random() * rewards.length)];

                if (reward.type === "points") {
                    count += reward.amount;
                    document.getElementById("counter").innerText = count;
                } else if (reward.type === "multiplier") {
                    addBuff("multiplier", reward.amount, reward.duration);
                } else if (reward.type === "skin" && currentSkin < 5) {
                    currentSkin = 5;
                    applySkin();
                } else if (reward.type === "galaxy" && currentGalaxy < galaxies.length - 1) {
                    currentGalaxy++;
                    applyGalaxy();
                }

                showAchievement(`üéÅ –†—É–ª–µ—Ç–∫–∞: ${reward.text}`);
                localStorage.setItem('lastSpin', today);
            }, 3000);
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–∏–≥—Ä—É
        function openMinigame() {
            document.getElementById("minigame-btn").style.display = "none";
            setTimeout(() => {
                document.getElementById("minigame-btn").style.display = "inline-block";
            }, 5000);
        }

        // –ù–∞—á–∞—Ç—å –º–∏–Ω–∏-–∏–≥—Ä—É
        function startMinigame(type) {
            if (type === "timer") {
                document.getElementById("minigame-timer").style.display = "block";
                let timeLeft = 3;
                document.getElementById("time-left").innerText = timeLeft;
                const timer = setInterval(() => {
                    timeLeft--;
                    document.getElementById("time-left").innerText = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        document.getElementById("minigame-timer").style.display = "none";
                        showAchievement("‚è±Ô∏è –í—Ä–µ–º—è –≤—ã—à–ª–æ!");
                    }
                }, 1000);
            } else if (type === "coins") {
                document.getElementById("minigame-coins").style.display = "block";
                document.getElementById("coins-collected").innerText = 0;
                const coinArea = document.getElementById("coin-area");
                coinArea.innerHTML = "";
                for (let i = 0; i < 10; i++) {
                    const coin = document.createElement("div");
                    coin.classList.add("coin");
                    coin.innerText = "ü™ô";
                    coin.style.left = Math.random() * 80 + 10 + "%";
                    coin.style.top = Math.random() * 80 + 10 + "%";
                    coin.onclick = () => {
                        coin.remove();
                        let collected = parseInt(document.getElementById("coins-collected").innerText);
                        collected++;
                        document.getElementById("coins-collected").innerText = collected;
                        if (collected >= 10) {
                            count += 500;
                            document.getElementById("counter").innerText = count;
                            document.getElementById("minigame-coins").style.display = "none";
                            showAchievement("ü™ô –ú–∏–Ω–∏-–∏–≥—Ä–∞ –ø—Ä–æ–π–¥–µ–Ω–∞! +500 –æ—á–∫–æ–≤!");
                        }
                    };
                    coinArea.appendChild(coin);
                }
            }
        }

        // –ö–ª–∏–∫ –ø–æ —Ç–∞–π–º–µ—Ä—É
        function clickTimer() {
            const timer = document.getElementById("timer");
            if (timer.classList.contains("green")) {
                count += 100;
                document.getElementById("counter").innerText = count;
                document.getElementById("minigame-timer").style.display = "none";
                showAchievement("‚è±Ô∏è –£—Å–ø–µ—à–Ω–æ! +100 –æ—á–∫–æ–≤!");
            } else {
                document.getElementById("minigame-timer").style.display = "none";
                showAchievement("‚è±Ô∏è –ü—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è!");
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
        setInterval(() => {
            const timer = document.getElementById("timer");
            if (timer) {
                if (Math.random() > 0.5) {
                    timer.classList.add("green");
                } else {
                    timer.classList.remove("green");
                }
            }
        }, 500);

        // –£–ª—É—á—à–µ–Ω–∏—è
        function buyUpgrade() {
            const cost = parseInt(document.getElementById("cost1").innerText);
            if (count >= cost) {
                count -= cost;
                perClick += 1;
                document.getElementById("cost1").innerText = Math.floor(cost * 1.8);
                document.getElementById("perClick").innerText = perClick.toFixed(2);
                document.getElementById("counter").innerText = count;

                // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç—É
                quests.forEach(quest => {
                    if (!quest.completed && (quest.id === 3)) { // –£–ª—É—á—à–µ–Ω–∏—è
                        quest.progress++;
                    }
                });
                if (randomQuest && !randomQuest.completed && randomQuest.id === "random") {
                    randomQuest.progress++;
                }
                checkQuests();

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        function buyAutoclicker() {
            const cost = parseInt(document.getElementById("cost2").innerText);
            if (count >= cost) {
                count -= cost;
                autoClick += 1;
                document.getElementById("cost2").innerText = Math.floor(cost * 1.8);
                document.getElementById("autoClick").innerText = autoClick.toFixed(2);
                document.getElementById("counter").innerText = count;

                // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç—É
                quests.forEach(quest => {
                    if (!quest.completed && (quest.id === 3)) { // –£–ª—É—á—à–µ–Ω–∏—è
                        quest.progress++;
                    }
                });
                if (randomQuest && !randomQuest.completed && randomQuest.id === "random") {
                    randomQuest.progress++;
                }
                checkQuests();

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        function buyMultiplier() {
            const cost = parseInt(document.getElementById("cost3").innerText);
            if (count >= cost) {
                count -= cost;
                multiplier *= 2;
                document.getElementById("cost3").innerText = Math.floor(cost * 3);
                document.getElementById("counter").innerText = count;

                // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç—É
                quests.forEach(quest => {
                    if (!quest.completed && (quest.id === 3)) { // –£–ª—É—á—à–µ–Ω–∏—è
                        quest.progress++;
                    }
                });
                if (randomQuest && !randomQuest.completed && randomQuest.id === "random") {
                    randomQuest.progress++;
                }
                checkQuests();

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        function buyUpgradeX15() {
            const cost = parseInt(document.getElementById("cost4").innerText);
            if (count >= cost) {
                count -= cost;
                perClick *= 1.5;
                document.getElementById("cost4").innerText = Math.floor(cost * 2);
                document.getElementById("perClick").innerText = perClick.toFixed(2);
                document.getElementById("counter").innerText = count;

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        function buyAutoclickerPlus() {
            const cost = parseInt(document.getElementById("cost5").innerText);
            if (count >= cost) {
                count -= cost;
                autoClick += 0.5;
                document.getElementById("cost5").innerText = Math.floor(cost * 1.8);
                document.getElementById("autoClick").innerText = autoClick.toFixed(2);
                document.getElementById("counter").innerText = count;

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        function buyBuffBonus() {
            const cost = parseInt(document.getElementById("cost6").innerText);
            if (count >= cost) {
                count -= cost;
                // –î–æ–±–∞–≤–ª—è–µ–º –±–∞—Ñ—Ñ, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥—Ä—É–≥–∏—Ö –±–∞—Ñ—Ñ–æ–≤
                addBuff("shield", 1, 60); // 60 —Å–µ–∫ –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –±–∞—Ñ—Ñ–æ–≤
                document.getElementById("cost6").innerText = Math.floor(cost * 2);
                document.getElementById("counter").innerText = count;

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        function buyAutoclickerX2() {
            const cost = parseInt(document.getElementById("cost7").innerText);
            if (count >= cost) {
                count -= cost;
                autoClick *= 2;
                document.getElementById("cost7").innerText = Math.floor(cost * 2);
                document.getElementById("autoClick").innerText = autoClick.toFixed(2);
                document.getElementById("counter").innerText = count;

                purchaseSound.currentTime = 0;
                purchaseSound.play();
            }
        }

        // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
        setInterval(() => {
            let autoValue = autoClick;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–∞–ª–∞–Ω—Ç—ã
            autoValue += talents.autoBonus.level * talents.autoBonus.value;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–º–µ–Ω–∏—è
            autoValue += skills.autoBonus.level * skills.autoBonus.value;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–∞—Ñ—Ñ—ã
            buffs.forEach(buff => {
                if (buff.type === "auto") autoValue += buff.amount;
            });

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å –≥–∞–ª–∞–∫—Ç–∏–∫–∏
            autoValue *= galaxies[currentGalaxy].bonus;

            if (autoValue > 0) {
                count += autoValue * multiplier;
                document.getElementById("counter").innerText = count;

                // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç—É (–æ—á–∫–∏)
                quests.forEach(quest => {
                    if (!quest.completed && (quest.id === 1)) { // –û—á–∫–∏
                        quest.progress = count;
                    }
                });
                if (randomQuest && !randomQuest.completed && randomQuest.id === "random") {
                    randomQuest.progress = count;
                }
                checkQuests();
            }
        }, 1000);

        // –ö–ª–∏–∫
        function clickCounter() {
            let clickValue = perClick;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–∞–ª–∞–Ω—Ç—ã
            clickValue += talents.clickBonus.level * talents.clickBonus.value;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–º–µ–Ω–∏—è
            clickValue += skills.clickBonus.level * skills.clickBonus.value;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–∞—Ñ—Ñ—ã
            buffs.forEach(buff => {
                if (buff.type === "click") clickValue += buff.amount;
            });

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å –≥–∞–ª–∞–∫—Ç–∏–∫–∏
            clickValue *= galaxies[currentGalaxy].bonus;

            count += clickValue * multiplier;
            document.getElementById("counter").innerText = count;

            // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç–∞–º
            quests.forEach(quest => {
                if (!quest.completed && (quest.id === 2)) { // –ö–ª–∏–∫
                    quest.progress++;
                }
            });

            if (randomQuest && !randomQuest.completed && randomQuest.id === "random") {
                randomQuest.progress++;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
            checkLevel();

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–ª–∞–Ω—Ç–æ–≤
            applyTalents();

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É–º–µ–Ω–∏–π
            applySkills();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–æ–≤
            checkQuests();

            // –ê–Ω–∏–º–∞—Ü–∏—è +1
            createClickEffect();

            // –ó–≤—É–∫ –∫–ª–∏–∫–∞
            clickSound.currentTime = 0;
            clickSound.play();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
            checkAchievements();
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
        function createClickEffect() {
            const button = document.getElementById("clicker");
            const effect = document.createElement("div");
            effect.classList.add("click-effect");
            effect.innerText = `+${(perClick * galaxies[currentGalaxy].bonus).toFixed(2)}`;
            effect.style.left = Math.random() * 80 + 10 + "%";
            effect.style.top = "50%";
            document.body.appendChild(effect);

            setTimeout(() => {
                effect.remove();
            }, 1000);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function checkAchievements() {
            for (let target of achievements) {
                if (count >= target && !unlocked.has(target)) {
                    unlocked.add(target);
                    showAchievement(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${target} –æ—á–∫–æ–≤!`);
                    achievementSound.currentTime = 0;
                    achievementSound.play();
                }
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        function showAchievement(text) {
            const achievement = document.getElementById("achievement");
            achievement.innerText = text;
            achievement.style.display = "block";
            setTimeout(() => {
                achievement.style.display = "none";
            }, 3000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞ —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateRandomQuest, 30000);

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        function saveGame() {
            localStorage.setItem('clickerSave', JSON.stringify({
                count: count,
                level: level,
                perClick: perClick,
                autoClick: autoClick,
                multiplier: multiplier,
                talentPoints: talentPoints,
                skillPoints: skillPoints,
                currentSkin: currentSkin,
                currentGalaxy: currentGalaxy,
                story: story,
                battle: battle,
                quests: quests,
                talents: talents,
                skills: skills,
                unlocked: Array.from(unlocked),
                buffs: buffs,
                lastRandomQuestTime: lastRandomQuestTime,
                randomQuest: randomQuest
            }));
        }

        setInterval(saveGame, 5000);
    </script>

</body>
</html>
